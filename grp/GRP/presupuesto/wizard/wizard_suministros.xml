<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_suministros_wizard" model="ir.ui.view">
        <field name="name">wizard.suministros.form</field>
        <field name="model">wizard.suministros</field>
        <field name="arch" type="xml">
        <form edit="false" create="false">
        <p></p>
        <h3>
        <div>
        <group col="4">
            <field name="fecha_inicio" string="Fecha de inicio"  />
            <field name="fecha_fin" string="Fecha fin" />
            <div class="col-sm-2">
                <a class="btn oe_highlight" id="busca_items">Buscar</a>
            </div>
        </group>
        </div>
        </h3>
        <notebook>
        <page string="Resultado">
                <div style="display:none;"  id="fecha_inicio_cal"><field name="fecha_inicio_cal"/></div>
                <div style="display:none;"  id="fecha_fin_cal"><field name="fecha_fin_cal"/></div>
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <div><br></br>
                    <table id="table_suministros_presu" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Filio S.S.</th>
                                <th>Fecha</th>
                                <th>Producto solicitado</th>
                                <th>Medida</th>
                                <th>Cantidad solicitada</th>
                                <th>Cantidad entregada</th>
                            </tr>
                        </thead>
                    </table>
                </div>
        <script>
                $("#busca_items" ).click(function() {
                    var fecha_inicio_cal = ($("#fecha_inicio_cal").text());
                    var fecha_fin_cal = ($("#fecha_fin_cal").text());

                    var urls = '/suministros/'; 
                    $('#table_suministros_presu').DataTable({
                        "responsive": "true",
                        "destroy": "true",
                        "ajax": {
                            "type" : "POST",
                            "url":urls,
                            "data": { 
                                csrf_token: $('#csrf_token').val(),
                                fecha_inicio_cal: fecha_inicio_cal,
                                fecha_fin_cal: fecha_fin_cal
                            },
                            "dataSrc": function ( datas ) {
                                    $("#csv_download").attr("href", datas.b64_data);
                                    return datas.items;
                                }
                            },
                        "columns": [
                            { "data": "ss" },
                            { "data": "fecha" },
                            { "data": "producto_solicit" },    
                            { "data": "uom_solicit" },
                            { "data": "cantidad_solicit" },
                            { "data": "cantidad_entregada" },
                        ],
                        "oLanguage": {
                            "sLengthMenu": "Mostrar _MENU_ registros",
                            "sEmptyTable": "No hay informaci√≥n",
                            "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ registros",
                            "sInfoEmpty": "Mostrando 0 to 0 of 0 registros",
                            "sLoadingRecords": "Cargando...",
                            "sProcessing": "Procesando...",
                            "sSearch": "Buscar:",
                            "sZeroRecords": "Sin resultados encontrados",
                            "oPaginate": {
                                "sFirst": "Primero",
                                "sLast": "Ultimo",
                                "sNext": "Siguiente",
                                "sPrevious": "Anterior"
                            }
                        },
                    });  
                });
        </script>
        </page>
        </notebook>
            <footer>
              <div>
              
                <button name="search_cuentas_origen" 
                        string="Descargar PDF" 
                        icon="fa-files-o" 
                        type="object" 
                        default_focus="1" 
                        style="display: none;"
                        class="oe_highlight"/>
                <a 
                    class="btn btn-success" 
                    icon="fa-file" 
                    id="csv_download" 
                    href="#" 
                    target="_blank" 
                    download="suministros.xls">

                <div class="fa fa-fw fa-file-excel-o o_button_icon"></div>Excel</a>
                    o
                <button string="Cancelar" class="oe_link" special="cancel" />
              </div>
            </footer>
        </form>
        </field>
    </record>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<record id="view_report_depreciacion_categoria_wizard" model="ir.ui.view">
		<field name="name">
			depreciaciones_categoria.wizard.form
		</field>
		<field name="model">
			depreciaciones_categoria.wizard
		</field>
		<field name="arch" type="xml">
			<form edit="false" create="false">
				<p>
				</p>
				<h3>
					<div>
						<group col="4">
							<field name="tipo" string="Reporte" />
							<field name="fecha_fin" string="Fecha de corte" attrs="{'invisible':[('tipo','!=',1)]}"/>
						</group>
						<group col="4">
							<field name="categorias" widget="many2many_tags" options="{'no_create': True}" />
                            <div class="col-sm-2" attrs="{'invisible':[('tipo','!=',1)]}">
								<a class="btn oe_highlight" id="busca_items">
									Buscar
								</a>
							</div>
                            <div class="col-sm-2">
								<a class="btn oe_highlight" id="busca_items_activos" attrs="{'invisible':[('tipo','!=',2)]}">
									Buscar
								</a>
							</div>
						</group>
					</div>
				</h3>
				<notebook>
					<page string="Resultado">
						<div style="display:none;" id="csv_url_div">
							<field name="csv_urls" />
						</div>
						<div style="display:none;" id="tipo_cal">
							<field name="tipo_cal" />
						</div>
						<div style="display:none;" id="fecha_fin_cal">
							<field name="fecha_fin_cal" />
						</div>
						<div style="display:none;" id="categorias_cal">
							<field name="categorias_cal" />
						</div>
						<div>
							<br>
							</br>
							<table id="table_activos" class="table table-striped" attrs="{'invisible':[('tipo','!=',1)]}">
								<thead>
									<tr>
										<th>
											Nombre activo
										</th>
										<th>
											Referencia
										</th>
										<th>
											Valor bruto
										</th>
										<th>
											Total depreciado
										</th>
										<th>
											Residual
										</th>
									</tr>
								</thead>
							</table>
                            <table id="table_activos_depreciaciones" class="table table-striped" attrs="{'invisible':[('tipo','!=',2)]}">
								<thead>
									<tr>
										<th>
											Nombre activo
										</th>
										<th>
											Referencia
										</th>
										<th>
											Valor bruto
										</th>
										<th>
											No. Depreciaciones
										</th>
										<th>
											Fecha Activo
										</th>
									</tr>
								</thead>
							</table>
						</div>
						<script>
							$("#busca_items_activos" ).click(function() {
							var fecha_fin_cal = $("#fecha_fin_cal").text();
							var categorias_cal = $("#categorias_cal").text();
                            var tipo_cal = $("#tipo_cal").text();
							var urls = '/activos_depreciacion/'+tipo_cal+'/'+fecha_fin_cal+'/'+categorias_cal;
							$('#table_activos_depreciaciones').DataTable({
							"responsive": "true",
							"destroy": "true",
							"ajax": {
							"language": {'url': '/resguardos/static/src/js/Spanish.json'},
							"type" : "GET",
							"url":urls,
							"dataSrc": function ( datas ) {
							$("#csv_download").attr("href", datas.b64_data);
							return datas.items;
							}
							},
							"columns": [
							{ "data": "nombre_activo" },
							{ "data": "referencia" },
							{ "data": "valor_bruto" },
							{ "data": "no_depreciaciones" },
							{ "data": "fecha_activo" },
							]
							});
							});
						</script>
                        <script>
							$("#busca_items" ).click(function() {
							var fecha_fin_cal = $("#fecha_fin_cal").text();
							var categorias_cal = $("#categorias_cal").text();
                            var tipo_cal = $("#tipo_cal").text();
							var urls = '/activos_depreciacion/'+tipo_cal+'/'+fecha_fin_cal+'/'+categorias_cal;
							$('#table_activos').DataTable({
							"responsive": "true",
							"destroy": "true",
							"ajax": {
							"language": {'url': '/resguardos/static/src/js/Spanish.json'},
							"type" : "GET",
							"url":urls,
							"dataSrc": function ( datas ) {
							$("#csv_download").attr("href", datas.b64_data);
							return datas.items;
							}
							},
							"columns": [
							{ "data": "nombre_activo" },
							{ "data": "referencia" },
							{ "data": "valor_bruto" },
							{ "data": "total_depreciado" },
							{ "data": "residual" },
							]
							});
							});
						</script>
						<!-- <field name="result_pc_html" widget="html"/> -->
					</page>
				</notebook>
				<footer>
					<div>
						<a class="btn btn-default" icon="fa-file" download="activo.xls" id="csv_download" style="background: #ddd;">
							<div class="fa fa-fw fa-file-excel-o o_button_icon">
							</div>
							Excel
						</a>
						or
						<button string="Cancelar" class="oe_link" special="cancel" />
					</div>
				</footer>
			</form>
		</field>
	</record>
</odoo>

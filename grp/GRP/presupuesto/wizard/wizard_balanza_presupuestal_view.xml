<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_balanza_presupuestal_wizard" model="ir.ui.view">
        <field name="name">balanza_presupuestal.wizard.form</field>
        <field name="model">balanza_presupuestal.wizard</field>
        <field name="arch" type="xml">
        <form edit="false" create="false">
        <div class="row">
            <div class="col-sm-3" id="fecha_inicio">Del: <field name="fecha_inicio"/></div>
            <div class="col-sm-3">a <field name="fecha_fin"/></div>
            <div class="col-sm-2" attrs="{'invisible':[('fecha_inicio','=',False)]}"><a class="btn oe_highlight" id="busca_items">Buscar</a></div>
        </div>
        <group>
                <div style="display:none;"  id="fecha_inicio_cal"><field name="fecha_inicio_cal"/></div>
                <div style="display:none;"  id="fecha_fin_cal"><field name="fecha_fin_cal"/></div>
                <!-- <field name="select_move" string="Cuentas" /> -->
        </group>
        <notebook>
        <page string="Balanza">
            <div><br></br>
                <table id="table_balanza_presu" class="table table-striped">
                    <thead>
                        <tr>
                            <th>Cuenta</th>
                            <th>Nombre</th>
                            <th>Debe</th>
                            <th>Haber</th>
                            <th>Saldo</th>
                        </tr>
                    </thead>
                </table>
            </div>
                    <script>
                            $("#busca_items" ).click(function() {
                                var fecha_inicio = $("#fecha_inicio_cal").text().split('/').reverse().join('-');
                                var fecha_fin =$("#fecha_fin_cal").text().split('/').reverse().join('-');
                                var urls = '/balanza_conta/'+fecha_inicio+'/'+fecha_fin; 
                                $('#table_balanza_presu').DataTable({
                                    "responsive": "true",
                                    "destroy": "true",
                                    "ajax": {
                                        "language": {'url': '/presupuestos/static/src/js/Spanish.json'},
                                        "type" : "GET",
                                        "url":urls,
                                        "dataSrc": function ( datas ) {
                                                $("#csv_download").attr("href", datas.b64_data);
                                                return datas.items;
                                            }
                                        },
                                    "columns": [
                                        { "data": "code" },
                                        { "data": "name" },
                                            { "data": "debe" },
                                            { "data": "haber" },
                                            { "data": "saldo" },
                                    ]
                                });  
                            });
                    </script>
        </page>
        <page string="Opciones">
            <group col="4">
               <!-- <button name="sincronizar_balanza" string="Actualizar balanza" type="object" class="oe_highlight"   /> -->
            </group>
           </page>
        </notebook>
            <footer>
              <div>
              <button  attrs="{'invisible':[('fecha_inicio','=',False)]}" name="search_cuentas_origen" string="PDF" icon="fa-files-o" type="object" default_focus="1" class="oe_highlight" />
               <a attrs="{'invisible':[('fecha_inicio','=',False)]}" class="btn btn-success" icon="fa-file" id="csv_download" href="#" target="_blank" download="balanza_presupuestal.xls">
                <div class="fa fa-fw fa-file-excel-o o_button_icon"></div>Ecxel</a>
                o
                <button string="Cancelar" class="oe_link" special="cancel" />
              </div>
            </footer>
        </form>
        </field>
    </record>
</odoo>

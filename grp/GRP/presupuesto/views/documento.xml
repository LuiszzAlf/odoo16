<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <record model="ir.ui.view" id="presupuesto_documento_view_search">
        <field name="name">presupuesto.documento_view.search</field>
        <field name="model">presupuesto.documento</field>
        <field name="arch" type="xml">
            <search>
                <field name="concepto"/> 
                <field name="id" string="No. Doc"/>
                <filter string="Año" 
                  name="filter_by_ejercicio"
                  domain="[('ejercicio', '=', ((context_today().strftime('%Y'))))]"
                />
                <filter string="Periodo" 
                  name="group_by_periodo"
                  context="{'group_by':['periodo']}"
                />
            </search>
        </field>
    </record>
    <record id="presupuesto_documento_view_form" model="ir.ui.view">
      <field name="name">presupuesto.documento.form</field>
      <field name="model">presupuesto.documento</field>
      <field name="arch" type="xml">
        <form duplicate="false" string="Listado de Documentos">
          <header>
            <field name="status" widget="statusbar"/> 
            <button type="object" string="Cambiar a borrador"
                    icon="fa-flag-o" name="button_state_off" attrs="{'invisible': [('status', '!=', 'open')]}">
            </button>
            <button type="object" string="Validar"
                    class="oe_highlight"
                    icon="fa-flag-o" name="button_state_on" attrs="{'invisible': [('status', '!=', 'close')]}">
            </button>
              <button class="oe_stat_button" name="delete_documento_comprometido"
                          string="Eliminar Doc. Comp" type="object"
                          icon="fa-trash"
                          attrs="{'invisible': [('clase_documento', '!=', 6)]}"
                          confirm="¿Estas seguro de realizar esta operación?" />
          </header>
          <sheet string="Documento">
            <group string="Documento">
              <group>
                <field name="concepto"/>
                <field name="clase_documento"/>
                <field name="fecha_documento"/>
                <field name="ejercicio"/>
                <field name="is_periodo_anterior" string="Momento de Periodo Anterior"/>
              </group>
              <group>
                <field name="version"/>
                <field name="fecha_contabilizacion"/>
                <field name="periodo"/>
                <field name="periodo_origen"  attrs="{'invisible': [('is_periodo_anterior', '=', 1)]}" string="Periodo del Momento"/>
                <field name="referencia_compra" string="Referencia" attrs="{'invisible': [('checar_referencia', '!=', 'COMPROMETIDO')]}"/>
                <field name="referencia_factura" string="Referencia" attrs="{'invisible': [('checar_referencia', '!=', 'DEVENGADO')]}" />
              
                <field name="checar_referencia" invisible="1"/>
                <field name="compra_id" />
                <field name="tipo" />
                <field name="id_nomina"  attrs="{'invisible': [('tipo', '!=', 'NOMINA')]}" />
              </group>

            </group>
            <notebook>
              <page string="Detalles">
                  <field name="detalle_documento_ids">
                  <tree string="Detalles del presupuesto" editable="bottom">
                    <field name="posicion"/>
                    <field name="fondo_economico"/>
                    <field name="posicion_presupuestaria"/>
                    <field name="centro_gestor"/>
                    <field name="area_funcional"/>
                    <field name="importe" sum="importe"/>
                  </tree>
                  <form string="Detalles del presupuesto">
                    <group col="4">
                      <field name="posicion"/>
                      <field name="fondo_economico"/>
                      <field name="posicion_presupuestaria"/>
                      <field name="centro_gestor"/>
                      <field name="area_funcional"/>
                      <field name="importe" sum="importe"/>
      
                    </group>
                  </form>
                </field>
              </page>
              <page string="Contabilidad">
                <field name="move_id">
                  <field name="name"/>
                <!-- <tree string="Detalles del presupuesto" editable="bottom">
                  <field name="posicion"/>
                  <field name="fondo_economico"/>
                  <field name="posicion_presupuestaria"/>
                  <field name="centro_gestor"/>
                  <field name="area_funcional"/>
                  <field name="importe" sum="importe"/>
                </tree>
                <form string="Detalles del presupuesto">
                  <group col="4">
                    <field name="posicion"/>
                    <field name="fondo_economico"/>
                    <field name="posicion_presupuestaria"/>
                    <field name="centro_gestor"/>
                    <field name="area_funcional"/>
                    <field name="importe" sum="importe"/>
    
                  </group>
                </form> -->
              </field>
            </page>
            </notebook>
          </sheet>
          <div class="oe_chatter" >
            <field  name = "message_follower_ids"  widget ="mail_followers" /> 
            <field  name = "message_ids"  widget = "mail_thread" /> 
        </div>
        </form>
      </field>
    </record>

    <record id="presupuesto_documento_view_tree" model="ir.ui.view">
      <field name="name">presupuesto.documento.tree</field>
      <field name="model">presupuesto.documento</field>
      <field name="arch" type="xml">
        <tree>
          <field name="concepto"/>
          <field name="id" string="No. Doc"/>
          <field name="partida_presupuestal" string="Partida"/>
          <field name="clase_documento"/>
          <field name="version"/>
          <field name="fecha_documento"/>
          <field name="fecha_contabilizacion"/>
          <field name="ejercicio"/>
          <field name="periodo"/>
          <field name="importe"  sum="importe"/>
           <field name="status" />
        </tree>
      </field>
    </record>

    <record id="presupuesto_documento_action" model="ir.actions.act_window">
      <field name="name">Documento</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">presupuesto.documento</field>
      <field name="view_type">form</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'search_default_filter_by_ejercicio': 1}</field>
    </record>
  </data>
</odoo>
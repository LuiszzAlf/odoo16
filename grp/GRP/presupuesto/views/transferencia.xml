<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <record model="ir.ui.view" id="prespuesto_transferencia_search">
      <field name="name">presupuesto.trasferencia.search</field>
      <field name="model">presupuesto.transferencia</field>
      <field name="arch" type="xml">
        <search>
          <field name="concepto"/>
          <field name="importe"/>
        </search>
      </field>
    </record>

    <record id="prespuesto_transferencia_form_view" model="ir.ui.view">
      <field name="name">presupuesto.transferencia.form</field>
      <field name="model">presupuesto.transferencia</field>
      <field name="arch" type="xml">
        <form string="Formulario de Reclasificación">
          <header>
            <button name="cancel_reclasificacion" string="Cancelar Reclasificación" type="object" confirm="¿Estas seguro(a) de realizar esta operación?" attrs="{'invisible': ['|',('state', '=', 'progress'),('state', '=', 'cancel')]}" class="btn-primary" style="background-color: #ff0000; border-color:#ff0000;" icon='fa-trash-o' />
            <button name="print_reclasificacion" string="Imprimir Póliza" type="object" attrs="{'invisible': ['|',('state', '=', 'progress'),('state', '=', 'cancel')]}" class="btn-primary" icon='fa-print' />
            <field name="state" widget="statusbar"/>
          </header>
          <sheet>
            <group string="Reclasificación" col="4">
              <field name="fecha_documento"/>
              <field name="fecha_contabilizacion"/>
              <field name="ejercicio"/>
              <field name="periodo"/>
              <field name="importe"/>
              <field name="concepto"/>
            </group>
            <notebook>
              <page string="Reclasificación de recursos">
                <field name="detalle_transferencia_ids">
                  <tree string="Transferencias" decoration-success="tipo_reclasificacion == 'AMPLIACION'" decoration-danger="tipo_reclasificacion == 'REDUCCION'">
                    <field name="tipo_reclasificacion"/>
                    <field name="de_posicion_presupuestaria" string="Posición Presupuestaria -"/>
                    <field name="de_importe" attrs="{'invisible': [('de_importe', '=', 0)]}" sum="de_importe" string="Reducción"/>
                    <field name="doc_reduccion" string='Doc. Reduccion' />
                    <field name="para_posicion_presupuestaria" string="Posición Presupuestaria +"/>
                    <field name="para_importe" attrs="{'invisible': [('para_importe', '=', 0)]}" sum="para_importe" string="Ampliación"/>
                    <field name="doc_ampliacion" string='Doc. Ampliacion'/>
                  </tree>
                  <form string="Reclasificación">
                    <group>
                      <field name="tipo_reclasificacion"/>
                      <group col="2">
                        <field name="de_posicion_presupuestaria" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'AMPLIACION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'REDUCCION')]}"/>
                        <field name="para_posicion_presupuestaria" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'REDUCCION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'AMPLIACION')]}"/>
                        <field name="de_centro_gestor" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'AMPLIACION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'REDUCCION')]}"/>
                        <field name="para_centro_gestor" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'REDUCCION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'AMPLIACION')]}"/>
                        <field name="doc_reduccion" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'AMPLIACION'),('tipo_reclasificacion', '=', False)]}"/>
                        <field name="doc_ampliacion" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'REDUCCION'),('tipo_reclasificacion', '=', False)]}"/>
                      </group>
                      <group col="2">
                        <field name="de_area_funcional" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'AMPLIACION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'REDUCCION')]}"/>
                        <field name="para_area_funcional" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'REDUCCION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'AMPLIACION')]}"/>
                        <field name="de_importe" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'AMPLIACION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'REDUCCION')]}"/>
                        <field name="para_importe" attrs="{'invisible': ['|',('tipo_reclasificacion', '=', 'REDUCCION'),('tipo_reclasificacion', '=', False)], 'required': [('tipo_reclasificacion', '=', 'AMPLIACION')]}"/>
                      </group>
                    </group>
                  </form>
                </field>
              </page>
              <page string="Poliza">
                <field name="move_id">
                  <tree string="Transferencias" create="false">
                    <field name="date"/>
                    <field name="ref"/>
                    <field name="journal_id"/>
                    <!-- <field name="amount" sum="Total Amount"/> -->
                    <field name="state"/>
                    <field name="currency_id" invisible="1"/>
                  </tree>
                </field>
              </page>
            </notebook>
          </sheet>
          <div class="oe_chatter">
            <field  name = "message_follower_ids"  widget ="mail_followers" />
            <field  name = "message_ids"  widget = "mail_thread" />
          </div>
        </form>
      </field>
    </record>

    <record id='presupuesto_transferencia_tree' model='ir.ui.view'>
      <field name='name'>presupuesto.transferencia.tree</field>
      <field name='model'>presupuesto.transferencia</field>
      <field name='arch' type='xml'>
        <tree string='Listado de Reclasificación' decoration-success="state == 'post'" decoration-danger="state == 'cancel'">
          <field name="fecha_documento"/>
          <field name="concepto"/>
          <field name="importe" sum="importe"/>
          <field name="state" string="Estado"/>
          <!--<field name="move_id" string="Poliza"/>-->
        </tree>
      </field>
    </record>

    <record model="ir.actions.act_window" id="prespuesto_transferencia_action">
      <field name="name">Reclasificación</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">presupuesto.transferencia</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'search_default_group_by_ejercicio': 1, 'search_default_group_by_fecha_documento': 1, 'search_default_group_by_state': 1}</field>
      <field name="domain">[]</field>
      <field name="view_id" ref="presupuesto_transferencia_tree"/>
    </record>
  </data>
</odoo>